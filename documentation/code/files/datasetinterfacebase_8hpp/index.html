<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://gambitbsm.github.io/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://gambitbsm.github.io/fonts/vendor/jost/jost-v4-latin-500.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://gambitbsm.github.io/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><script>(()=>{var e=localStorage.getItem("theme");e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><link rel=stylesheet href=https://gambitbsm.github.io/main.2b4f179ba5137bf560410d5863d012cb95c0a7504da18190247e40a43544a8252fba5dc321f967a611ca9a4d80dec44fabc75d108c7c0e4e8ed381ec007b7391.css integrity="sha512-K08Xm6UTe/VgQQ1YY9ASy5XAp1BNoYGQJH5ApDVEqCUvul3DIflnphHKmk2A3sRPq8ddEIx8Dk6O04HsAHtzkQ==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>file hdf5printer/DataSetInterfaceBase.hpp - GAMBIT</title><meta name=description content="[No description available]"><link rel=canonical href=https://gambitbsm.github.io/documentation/code/files/datasetinterfacebase_8hpp/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="file hdf5printer/DataSetInterfaceBase.hpp"><meta property="og:description" content="[No description available]"><meta property="og:url" content="https://gambitbsm.github.io/documentation/code/files/datasetinterfacebase_8hpp/"><meta property="og:site_name" content="GAMBIT"><meta property="og:image" content="https://gambitbsm.github.io/gambit_logo.png"><meta property="og:image:alt" content="GAMBIT"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content><meta name=twitter:creator content><meta name=twitter:title content="file hdf5printer/DataSetInterfaceBase.hpp"><meta name=twitter:description content="[No description available]"><meta name=twitter:image content="https://gambitbsm.github.io/gambit_logo.png"><meta name=twitter:image:alt content="file hdf5printer/DataSetInterfaceBase.hpp"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://gambitbsm.github.io/#/schema/organization/1","name":"Doks","url":"https://gambitbsm.github.io/","sameAs":["https://github.com/GambitBSM"],"logo":{"@type":"ImageObject","@id":"https://gambitbsm.github.io/#/schema/image/1","url":"https://gambitbsm.github.io/logo-doks.png","width":450,"height":416,"caption":"Doks"},"image":{"@id":"https://gambitbsm.github.io/#/schema/image/1"}},{"@type":"WebSite","@id":"https://gambitbsm.github.io/#/schema/website/1","url":"https://gambitbsm.github.io/","name":"GAMBIT","description":"Documentation for the Global And Modular BSM Inference Tool","publisher":{"@id":"https://gambitbsm.github.io/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://gambitbsm.github.io/documentation/code/files/datasetinterfacebase_8hpp/","url":"https://gambitbsm.github.io/documentation/code/files/datasetinterfacebase_8hpp/","name":"file hdf5printer\/DataSetInterfaceBase.hpp","description":"[No description available]","isPartOf":{"@id":"https://gambitbsm.github.io/#/schema/website/1"},"about":{"@id":"https://gambitbsm.github.io/#/schema/organization/1"},"datePublished":"0001-01-01T00:00:00CET","dateModified":"0001-01-01T00:00:00CET","breadcrumb":{"@id":"https://gambitbsm.github.io/documentation/code/files/datasetinterfacebase_8hpp/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://gambitbsm.github.io/documentation/code/files/datasetinterfacebase_8hpp/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://gambitbsm.github.io/documentation/code/files/datasetinterfacebase_8hpp/"]}]},{"@type":"BreadcrumbList","@id":"https://gambitbsm.github.io/documentation/code/files/datasetinterfacebase_8hpp/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://gambitbsm.github.io/","url":"https://gambitbsm.github.io/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://gambitbsm.github.io/documentation/","url":"https://gambitbsm.github.io/documentation/","name":"Documentation"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://gambitbsm.github.io/documentation/code/","url":"https://gambitbsm.github.io/documentation/code/","name":"Code"}},{"@type":"ListItem","position":4,"item":{"@type":"WebPage","@id":"https://gambitbsm.github.io/documentation/code/files/","url":"https://gambitbsm.github.io/documentation/code/files/","name":"Files"}},{"@type":"ListItem","position":5,"item":{"@id":"https://gambitbsm.github.io/documentation/code/files/datasetinterfacebase_8hpp/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://gambitbsm.github.io/documentation/code/files/datasetinterfacebase_8hpp/#/schema/image/2","url":"https://gambitbsm.github.io/gambit_logo.png","contentUrl":"https://gambitbsm.github.io/gambit_logo.png","caption":"file hdf5printer\/DataSetInterfaceBase.hpp"}]}]}</script><meta name=theme-color content="#fff"><link rel=icon href=https://gambitbsm.github.io/favicon.ico sizes=any><link rel=icon type=image/svg+xml href=https://gambitbsm.github.io/favicon.svg><link rel=apple-touch-icon sizes=180x180 href=https://gambitbsm.github.io/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://gambitbsm.github.io/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://gambitbsm.github.io/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=https://gambitbsm.github.io/site.webmanifest></head><body class="documentation single light"><div class=sticky-top><div class=header-bar></div><header class="navbar navbar-expand-md navbar-light doks-navbar"><nav class="container-xxl flex-wrap flex-md-nowrap" aria-label="Main navigation"><a class="navbar-brand p-0 me-auto" href=https://gambitbsm.github.io/ aria-label=GAMBIT><img class=logo-light src=https://gambitbsm.github.io//images/gambit_logo.png width=50px>
<img class="logo-dark d-none" src=https://gambitbsm.github.io//images/gambit_logo.png width=50px>
GAMBIT</a>
<button class="btn btn-menu order-2 d-block d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasDoks aria-controls=offcanvasDoks aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-end border-0 py-lg-1" tabindex=-1 id=offcanvasDoks data-bs-backdrop=true aria-labelledby=offcanvasDoksLabel><div class="header-bar d-lg-none"></div><div class="offcanvas-header d-lg-none"><h2 class="h5 offcanvas-title ps-2" id=offcanvasDoksLabel><a class=text-dark href=/>GAMBIT</a></h2><button type=button class="btn-close text-reset me-2" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class="offcanvas-body p-4 p-lg-0"><ul class="nav flex-column flex-lg-row align-items-lg-center mt-2 mt-lg-0 ms-lg-2 me-lg-auto"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle ps-0 py-1" href=# id=navbarDropdownMenuLink role=button data-bs-toggle=dropdown aria-expanded=false>Releases
<span class=dropdown-caret><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></a><ul class="dropdown-menu dropdown-menu-main shadow rounded border-0" aria-labelledby=navbarDropdownMenuLink><li><a class=dropdown-item href=https://github.com/GambitBSM/gambit_2.2>GAMBIT 2-2 ⧉</a></li><li><a class=dropdown-item href=https://github.com/GambitBSM/gambit_2.1>GAMBIT 2-1 ⧉</a></li><li><a class=dropdown-item href=https://github.com/GambitBSM/gambit_2.2/tags>All releases ⧉</a></li></ul></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle ps-0 py-1" href=# id=navbarDropdownMenuLink role=button data-bs-toggle=dropdown aria-expanded=false>Documentation
<span class=dropdown-caret><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></a><ul class="dropdown-menu dropdown-menu-main shadow rounded border-0" aria-labelledby=navbarDropdownMenuLink><li><a class=dropdown-item href=/documentation/installation/introduction/>Installation</a></li><li><a class=dropdown-item href=/documentation/examples/colliderbit_example>Examples</a></li><li><a class=dropdown-item href=/documentation/help/common_problems_and_questions/>Help</a></li><li><a class=dropdown-item href=/documentation/code/index_classes>Code Reference</a></li></ul></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle ps-0 py-1" href=# id=navbarDropdownMenuLink role=button data-bs-toggle=dropdown aria-expanded=false>Community
<span class=dropdown-caret><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></a><ul class="dropdown-menu dropdown-menu-main shadow rounded border-0" aria-labelledby=navbarDropdownMenuLink><li><a class=dropdown-item href=/community/publications/>Publications</a></li><li><a class=dropdown-item href=/community/talks/>Talks</a></li><li><a class=dropdown-item href=/community/members/>Members</a></li><li><a class="dropdown-item active" href=/community/code_of_conduct/ aria-current=true>Code of Conduct</a></li><li><a class=dropdown-item href=/community/contact/>Contact</a></li></ul></li></ul><hr class="text-black-50 my-4 d-lg-none"><form class="doks-search position-relative flex-grow-1 ms-lg-auto me-lg-2"><input id=search class="form-control is-search" type=search placeholder="Search site..." aria-label="Search site..." autocomplete=off><div id=suggestions class="shadow bg-white rounded d-none"></div></form><hr class="text-black-50 my-4 d-lg-none"><ul class="nav flex-column flex-lg-row"><li class=nav-item><a class="nav-link social-link" href=https://github.com/GambitBSM><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><small class="ms-2 d-lg-none">GitHub</small></a></li></ul><hr class="text-black-50 my-4 d-lg-none"><button id=mode class="btn btn-link" type=button aria-label="Toggle user interface mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></div></div></nav></header></div><div class="wrap container-xxl" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar"><nav class=docs-links aria-label="Main navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-installation aria-expanded=false>
Installation</button><div class=collapse id=section-installation><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/documentation/installation/introduction/>Getting Started</a></li><li><a class="docs-link rounded" href=/documentation/installation/docker_usage/>Docker Usage</a></li><li><a class="docs-link rounded" href=/documentation/installation/installation_for_linux/>Installation for Linux</a></li><li><a class="docs-link rounded" href=/documentation/installation/installation_for_windows/>Installation for Windows</a></li><li><a class="docs-link rounded" href=/documentation/installation/installation_for_macos/>Installation for macOS</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-examples aria-expanded=false>
Examples</button><div class=collapse id=section-examples><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/documentation/examples/colliderbit_example/>ColliderBit Example</a></li><li><a class="docs-link rounded" href=/documentation/examples/anotherbit/>AnotherBit</a></li><li><a class="docs-link rounded" href=/documentation/examples/anotherbit2/>AnotherBit2</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-help aria-expanded=false>
Help</button><div class=collapse id=section-help><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/documentation/help/common_problems_and_questions/>Common Problems and Questions</a></li><li><a class="docs-link rounded" href=/documentation/help/compiler_matrix/>Compiler Matrix</a></li><li><a class="docs-link rounded" href=/documentation/help/known_issues/>Known Issues</a></li><li><a class="docs-link rounded" href=/documentation/help/configuration_examples/>Configuration Examples</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-code aria-expanded=false>
Code Reference</button><div class=collapse id=section-code><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/documentation/code/index_classes/>Classes</a></li><li><a class="docs-link rounded" href=/documentation/code/index_files/>Files</a></li><li><a class="docs-link rounded" href=/documentation/code/index_pages/>Pages</a></li><li><a class="docs-link rounded" href=/documentation/code/index_namespaces/>Namespaces</a></li></ul></div></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=d-xl-none><button class="btn btn-outline-primary btn-sm doks-toc-toggle collapsed" type=button data-bs-toggle=collapse data-bs-target=#onThisPage aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle On this page navigation">
<span>On this page</span>
<span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></span></button><div class=collapse id=onThisPage><div class="card card-body mt-3 py-1"><div class=page-links><nav id=TableOfContents><ul><li><a href=#namespaces>Namespaces</a></li><li><a href=#classes>Classes</a></li><li><a href=#detailed-description>Detailed Description</a></li><li><a href=#source-code>Source code</a></li></ul></nav></div></div></div></div><div class="page-links d-none d-xl-block"><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#namespaces>Namespaces</a></li><li><a href=#classes>Classes</a></li><li><a href=#detailed-description>Detailed Description</a></li><li><a href=#source-code>Source code</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9 mx-xl-auto"><nav aria-label=breadcrumb><ol class=breadcrumb><li class=breadcrumb-item><a href=/>Home</a></li><li class=breadcrumb-item><a href=/documentation/>Documentation</a></li><li class=breadcrumb-item><a href=/documentation/code/>Code Reference</a></li><li class="breadcrumb-item active" aria-current=page>file hdf5printer/DataSetInterfaceBase.hpp</li></ol></nav><p class=lead></p><h1 id=file-hdf5printer-datasetinterfacebase-hpp>file hdf5printer/DataSetInterfaceBase.hpp</h1><p>[No description available] <a href=#detailed-description>More&mldr;</a></p><h2 id=namespaces>Namespaces <a href=#namespaces class=anchor aria-hidden=true>#</a></h2><table><thead><tr><th>Name</th></tr></thead><tbody><tr><td><strong><a href=/documentation/code/namespaces/namespacegambit/>Gambit</a></strong><br>TODO: see if we can use this one:</td></tr><tr><td><strong><a href=/documentation/code/namespaces/namespacegambit_1_1printers/>Gambit::Printers</a></strong><br>Forward declaration.</td></tr></tbody></table><h2 id=classes>Classes <a href=#classes class=anchor aria-hidden=true>#</a></h2><table><thead><tr><th></th><th>Name</th></tr></thead><tbody><tr><td>class</td><td><strong><a href=/documentation/code/classes/classgambit_1_1printers_1_1datasetinterfacebase/>Gambit::Printers::DataSetInterfaceBase</a></strong><br>Wrapper object to manage a single dataset.</td></tr></tbody></table><h2 id=detailed-description>Detailed Description <a href=#detailed-description class=anchor aria-hidden=true>#</a></h2><p><strong>Author</strong>: Ben Farmer (<a href=mailto:benjamin.farmer@fysik.su.se>benjamin.farmer@fysik.su.se</a>)</p><p><strong>Date</strong>: 2015 May</p><p>Declaration for class DataSetInterfaceBase</p><p>This class and its daughters are the main tools used by the hdf5 printer for actually performing the output writes to hdf5 files. This base class deals with creating the hdf5 file and basic buffer constructs, but not the actual writing to file (this is dependent on the dimensionality of the buffer).</p><hr><p>Authors (add name and date if you modify):</p><hr><h2 id=source-code>Source code <a href=#source-code class=anchor aria-hidden=true>#</a></h2><pre><code>//   GAMBIT: Global and Modular BSM Inference Tool
//   *********************************************
///  \file
///
///  Declaration for class DataSetInterfaceBase
///
///  This class and its daughters are the main
///  tools used by the hdf5 printer for actually
///  performing the output writes to hdf5 files.
///  This base class deals with creating the
///  hdf5 file and basic buffer constructs, but
///  not the actual writing to file (this is
///  dependent on the dimensionality of the
///  buffer).
///
///  *********************************************
///
///  Authors (add name and date if you modify):
///
///  \author Ben Farmer
///          (benjamin.farmer@fysik.su.se)
///  \date 2015 May
///
///  *********************************************

#ifndef __DataSetInterfaceBase_hpp__
#define __DataSetInterfaceBase_hpp__

// HDF5 C bindings
#include &lt;hdf5.h&gt;

// Gambit
#include &quot;gambit/Utils/standalone_error_handlers.hpp&quot;
#include &quot;gambit/Logs/logger.hpp&quot;

namespace Gambit {

  namespace Printers {

      /// Wrapper object to manage a single dataset
      // Mostly just creates the dataset and holds metadata about it
      // Would be nice to extend to handle writing as well, but currently
      // I have to do it differently depending on the RANK.
      template&lt;class T, std::size_t RECORDRANK, std::size_t CHUNKLENGTH&gt;
      class DataSetInterfaceBase
      {
        private:
         static const std::size_t DSETRANK = RECORDRANK+1; // Rank of the dataset array
         hid_t mylocation_id; // handle for where this datasets is located in the hdf5 file
         std::string myname; // name of the dataset in the hdf5 file

         // Dimension sizes for each record.
         // This only needs to be RECORDRANK long, however zero-size arrays are not
         // standard compliant so we will use arrays one larger than we need and
         // just ignore the last entry.
         std::size_t record_dims[DSETRANK];

         // Dataset and chunk dimensions
         hsize_t  dims[DSETRANK];
         hsize_t  maxdims[DSETRANK];
         hsize_t  chunkdims[DSETRANK];
         hsize_t  slicedims[DSETRANK];

         // flag to specify whether we should try to access an existing dataset or create a new one
         bool resume;

         // flag to record access mode for the dataset
         char access;

        protected:
         // Derived classes need full access to these

         // HDF5 type handle for datasets
         static const hid_t hdftype_id;

         // Handle for wrapped dataset
         hid_t dset_id;

         // Safe(r) getter for dataset handle
         hid_t get_dset_id() const
         {
           if(this-&gt;dset_id&lt;0)
           {
              std::ostringstream errmsg;
              errmsg &lt;&lt; &quot;Error getting handle for dataset with name: \&quot;&quot;&lt;&lt;get_myname()&lt;&lt;&quot;\&quot;. Handle id is invalid. Dataset wrapping has failed to occur correctly, and problems should have been detected before this, so this is a bug; please fix.&quot;;
              printer_error().raise(LOCAL_INFO, errmsg.str());
           }
           return this-&gt;dset_id;
         }

         // index of the beginning of the next empty slot in the output array
         // i.e. the offset in dimension 0 of the dataset needed to select the
         // next output hyperslab.
         unsigned long dsetnextemptyslab;

         // currently targeted index in output dataset
         // &quot;Virtual&quot; because write will not directly go to this position, it
         // will go into the buffer, but this is where the append should end
         // up after the buffer is written to file.
         unsigned long virtualwriteposition;

        public:
         // Const public data accessors
         std::string get_myname() const      { return myname; }
         std::size_t get_dsetrank() const    { return DSETRANK; }
         std::size_t get_chunklength() const { return CHUNKLENGTH; }
         const hsize_t* get_maxdsetdims() const    { return maxdims; }
         const hsize_t* get_chunkdims() const      { return chunkdims; }
         const hsize_t* get_slicedims() const      { return slicedims; }
         unsigned long get_nextemptyslab() const     { return dsetnextemptyslab; }
         unsigned long dset_length() const            { return dims[0]; }
         char access_mode() const            { return access; }

         // To point &quot;next write&quot; cursor back at the beginning of a dataset, for overwriting everything
         void reset_nextemptyslab() { dsetnextemptyslab = 0; }

         // Full accessor needed for dataset dimensions
         // so that they can be updated when chunks are added
         hsize_t* dsetdims() { return dims; }

         /// Constructors
         DataSetInterfaceBase();
         DataSetInterfaceBase(hid_t location_id, const std::string&amp; name, const std::size_t rdims[DSETRANK], const bool resume, const char access);
         virtual ~DataSetInterfaceBase();

         /// Create a (chunked) dataset
         hid_t createDataSet(hid_t location_id, const std::string&amp; name, const std::size_t rdims[DSETRANK]);

         /// Open an existing dataset
         hid_t openDataSet(hid_t location_id, const std::string&amp; name, const std::size_t rdims[DSETRANK]);

         /// Close an open dataset
         void closeDataSet();

         /// Extend dataset to nearest multiple of CHUNKLENGTH above supplied length
         void extend_dset(const unsigned long i);

      };


      /// @{ DataSetInterfaceBase class member definitions

      // Define some static members
      template&lt;class T, std::size_t RR, std::size_t CL&gt;
      const hid_t DataSetInterfaceBase&lt;T,RR,CL&gt;::hdftype_id = get_hdf5_data_type&lt;T&gt;::type();

      /// Constructors
      template&lt;class T, std::size_t RR, std::size_t CL&gt;
      DataSetInterfaceBase&lt;T,RR,CL&gt;::DataSetInterfaceBase()
        : mylocation_id(-1)
        , myname()
        , record_dims()
        , resume(false)
        , access('r')
    , dset_id(-1)
        , dsetnextemptyslab(0)
      {}

      template&lt;class T, std::size_t RR, std::size_t CL&gt;
      DataSetInterfaceBase&lt;T,RR,CL&gt;::DataSetInterfaceBase(hid_t location_id, const std::string&amp; name, const std::size_t rdims[DSETRANK], const bool r, const char a)
        : mylocation_id(location_id)
        , myname(name)
        , record_dims() /* doh have to copy array element by element */
        , resume(r)
        , access(a)
        , dset_id(-1)
        , dsetnextemptyslab(0)
      {
        if(resume)
        {
           dset_id = openDataSet(location_id,name,rdims);
        }
        else
        {
           dset_id = createDataSet(location_id,name,rdims);
        }
        if(dset_id&lt;0)
        {
           std::ostringstream errmsg;
           errmsg &lt;&lt; &quot;Error! Failed to attach interface to dataset '&quot;&lt;&lt;this-&gt;get_myname()&lt;&lt;&quot;', and problem was not caught during open or create routine! This is a bug, please fix.&quot;;
           printer_error().raise(LOCAL_INFO, errmsg.str());
        }
        // copy rdims to record_dims
        for(std::size_t i=0; i&lt;DSETRANK; i++) { record_dims[i] = rdims[i]; }
      }

      /// Do cleanup (close dataset)
      template&lt;class T, std::size_t RR, std::size_t CL&gt;
      DataSetInterfaceBase&lt;T,RR,CL&gt;::~DataSetInterfaceBase()
      {
         // TODO: Having problems with copied objects sharing dataset identifiers, and closing datasets prematurely on each other.
         // To fix, will probably need to have a fancy copy constructor or something. Or wrap datasets in an
         // object which itself has a fancy copy constructor. For now, just leave dataset resources lying around,
         // probably won't cause any issues.
         // Or could explicity tell interface to close datasets before the objects are destroyed.
         //if(this-&gt;dset_id&gt;=0)
         //{
         //  herr_t status = H5Dclose(this-&gt;dset_id);
         //  if(status&lt;0)
         //  {
         //     logger() &lt;&lt; LogTags::printers &lt;&lt; LogTags::err &lt;&lt;LogTags::repeat_to_cerr&lt;&lt; LOCAL_INFO &lt;&lt; &quot;: Error destructing DataSetInterfaceBase! Failed to close wrapped dataset! (H5Dclose failed). No exception thrown because this will behave badly when throw from a destructor. (dataset name: &quot;&lt;&lt;myname&lt;&lt;&quot;)&quot;&lt;&lt;EOM;
         //  }
         //}
      }

      /// Release resources associated with the underlying dataset
      template&lt;class T, std::size_t RR, std::size_t CL&gt;
      void DataSetInterfaceBase&lt;T,RR,CL&gt;::closeDataSet()
      {
         if(this-&gt;dset_id&gt;=0)
         {
           herr_t status = H5Dclose(this-&gt;dset_id);
           if(status&lt;0)
           {
            std::ostringstream errmsg;
            errmsg &lt;&lt; &quot;Error closing dataset (with name: \&quot;&quot;&lt;&lt;this-&gt;get_myname()&lt;&lt;&quot;\&quot;) in HDF5 file. H5Dclose failed.&quot;;
            printer_error().raise(LOCAL_INFO, errmsg.str());
           }
         }
      }

      /// Create a (chunked) dataset
      template&lt;class T, std::size_t RECORDRANK, std::size_t CHUNKLENGTH&gt;
      hid_t DataSetInterfaceBase&lt;T,RECORDRANK,CHUNKLENGTH&gt;::createDataSet(hid_t location_id, const std::string&amp; name, const std::size_t rdims[DSETRANK])
      {
         // I'd like to declare rdims as rdims[RECORDRANK], but apparantly zero length arrays are not allowed,
         // so this would not compile in the RECORDRANK=0 case, which I need. Irritating.

         // Compute initial dataspace and chunk dimensions
         dims[0] = 0; //1*CHUNKLENGTH; // Start off with space for 1 chunk
         maxdims[0] = H5S_UNLIMITED; // No upper limit on number of records allowed in dataset
         chunkdims[0] = CHUNKLENGTH;
         slicedims[0] = 1; // Dimensions of a single record in the data space
         std::size_t loopsize = RECORDRANK; // Just tricking the compiler so it doesn't complain in the RECORDRANK=0 case.
         for(std::size_t i=0; i&lt;loopsize; i++)
         {
            // Set other dimensions to match record size
            dims[i+1]      = rdims[i];
            maxdims[i+1]   = rdims[i];
            chunkdims[i+1] = rdims[i];
            slicedims[i+1] = rdims[i];
         }

         // Create the data space
         //H5::DataSpace dspace(DSETRANK, dims, maxdims);
         hid_t dspace_id = H5Screate_simple(DSETRANK, dims, maxdims);
         if(dspace_id&lt;0)
         {
            std::ostringstream errmsg;
            errmsg &lt;&lt; &quot;Error creating dataset (with name: \&quot;&quot;&lt;&lt;name&lt;&lt;&quot;\&quot;) in HDF5 file. H5Screate_simple failed.&quot;;
            printer_error().raise(LOCAL_INFO, errmsg.str());
         }

         // Object containing dataset creation parameters
         //H5::DSetCreatPropList cparms;
         //cparms.setChunk(DSETRANK, chunkdims);
         hid_t cparms_id = H5Pcreate(H5P_DATASET_CREATE);
         if(cparms_id&lt;0)
         {
            std::ostringstream errmsg;
            errmsg &lt;&lt; &quot;Error creating dataset (with name: \&quot;&quot;&lt;&lt;name&lt;&lt;&quot;\&quot;) in HDF5 file. H5Pcreate failed.&quot;;
            printer_error().raise(LOCAL_INFO, errmsg.str());
         }

         herr_t status = H5Pset_chunk(cparms_id, DSETRANK, chunkdims);
         if(status&lt;0)
         {
            std::ostringstream errmsg;
            errmsg &lt;&lt; &quot;Error creating dataset (with name: \&quot;&quot;&lt;&lt;name&lt;&lt;&quot;\&quot;) in HDF5 file. H5Pset_chunk failed.&quot;;
            printer_error().raise(LOCAL_INFO, errmsg.str());
         }

         // Check if location id is invalid
         if(location_id==-1)
         {
            std::ostringstream errmsg;
            errmsg &lt;&lt; &quot;Error! Tried to create hdf5 dataset (with name: \&quot;&quot;&lt;&lt;myname&lt;&lt;&quot;\&quot;) at undefined location (location_id was -1). Please check that calling code supplied a valid location handle. This is a bug, please report it.&quot;;
            printer_error().raise(LOCAL_INFO, errmsg.str());
         }

         // Create the dataset
         hid_t output_dset_id;
         output_dset_id = H5Dcreate2(location_id, name.c_str(), hdftype_id, dspace_id, H5P_DEFAULT, cparms_id, H5P_DEFAULT);
         //output = location-&gt;createDataSet( name.c_str(), hdf_dtype.type(), dspace, cparms);
         if(output_dset_id&lt;0)
         {
               std::ostringstream errmsg;
               errmsg &lt;&lt; &quot;Error creating dataset (with name: \&quot;&quot;&lt;&lt;myname&lt;&lt;&quot;\&quot;) in HDF5 file. Dataset with same name may already exist&quot;;
               printer_error().raise(LOCAL_INFO, errmsg.str());
         }
         return output_dset_id;
      }

      /// Open an existing dataset
      /// It is assumed that we are resuming a run and therefore know what format this dataset should have
      template&lt;class T, std::size_t RECORDRANK, std::size_t CHUNKLENGTH&gt;
      hid_t DataSetInterfaceBase&lt;T,RECORDRANK,CHUNKLENGTH&gt;::openDataSet(hid_t location_id, const std::string&amp; name, const std::size_t rdims[DSETRANK])
      {
         // Open the dataset
         hid_t out_dset_id = H5Dopen2(location_id, name.c_str(), H5P_DEFAULT);
         if(out_dset_id&lt;0)
         {
            std::ostringstream errmsg;
            errmsg &lt;&lt; &quot;Error opening existing dataset (with name: \&quot;&quot;&lt;&lt;name&lt;&lt;&quot;\&quot;) in HDF5 file. H5Dopen2 failed.&quot; &lt;&lt; std::endl
                   &lt;&lt; &quot;You may have a corrupt hdf5 file from a previous run. Try using -r, or deleting the old output.&quot;;
            printer_error().raise(LOCAL_INFO, errmsg.str());
         }

         // Get dataspace of the dataset.
         //H5::DataSpace dataspace = dataset.getSpace();
         hid_t dspace_id = H5Dget_space(out_dset_id);
         if(dspace_id&lt;0)
         {
            std::ostringstream errmsg;
            errmsg &lt;&lt; &quot;Error opening existing dataset (with name: \&quot;&quot;&lt;&lt;name&lt;&lt;&quot;\&quot;) in HDF5 file. H5Dget_space failed.&quot;;
            printer_error().raise(LOCAL_INFO, errmsg.str());
         }

         // Get the number of dimensions in the dataspace.
         //int rank = dataspace.getSimpleExtentNdims();
         int rank = H5Sget_simple_extent_ndims(dspace_id);
         if(rank&lt;0)
         {
            std::ostringstream errmsg;
            errmsg &lt;&lt; &quot;Error opening existing dataset (with name: \&quot;&quot;&lt;&lt;name&lt;&lt;&quot;\&quot;) in HDF5 file. H5Sget_simple_extent_ndims failed.&quot;;
            printer_error().raise(LOCAL_INFO, errmsg.str());
         }
         if(rank!=DSETRANK)
         {
            std::ostringstream errmsg;
            errmsg &lt;&lt; &quot;Error while accessing existing dataset (with name: \&quot;&quot;&lt;&lt;myname&lt;&lt;&quot;\&quot;) in HDF5 file. Rank of dataset (&quot;&lt;&lt;rank&lt;&lt;&quot;) does not match the expected rank (&quot;&lt;&lt;DSETRANK&lt;&lt;&quot;).&quot;;
            printer_error().raise(LOCAL_INFO, errmsg.str());
         }

         // Get the dimension size of each dimension in the dataspace
         // now that we know ndims matches DSETRANK.
         hsize_t dims_out[DSETRANK];
         //int ndims = dataspace.getSimpleExtentDims( dims_out, NULL);
         int ndims = H5Sget_simple_extent_dims(dspace_id, dims_out, NULL);
         if(ndims&lt;0)
         {
            std::ostringstream errmsg;
            errmsg &lt;&lt; &quot;Error while accessing existing dataset (with name: \&quot;&quot;&lt;&lt;myname&lt;&lt;&quot;\&quot;) in HDF5 file. Failed to retrieve dataset extents (H5Sget_simple_extent_dims failed).&quot;;
            printer_error().raise(LOCAL_INFO, errmsg.str());
         }

         // Update parameters to match dataset contents
         // Compute initial dataspace and chunk dimensions
         dims[0] = dims_out[0]; // Set to match existing data
         maxdims[0] = H5S_UNLIMITED; // No upper limit on number of records allowed in dataset
         chunkdims[0] = CHUNKLENGTH;
         slicedims[0] = 1; // Dimensions of a single record in the data space
         std::size_t loopsize = RECORDRANK; // Just tricking the compiler so it doesn't complain in the RECORDRANK=0 case.
         for(std::size_t i=0; i&lt;loopsize; i++)
         {
            // Set other dimensions to match record size
            dims[i+1]      = rdims[i];
            maxdims[i+1]   = rdims[i];
            chunkdims[i+1] = rdims[i];
            slicedims[i+1] = rdims[i];

            // Check that record size matches the existing dataset
            if(dims[i+1] != dims_out[i+1])
            {
               std::ostringstream errmsg;
               errmsg &lt;&lt; &quot;Error while accessing existing dataset (with name: \&quot;&quot;&lt;&lt;myname&lt;&lt;&quot;\&quot;) in HDF5 file. Size of dimension &quot;&lt;&lt;i+1&lt;&lt;&quot; (&quot;&lt;&lt;dims_out[i+1]&lt;&lt;&quot;) does not match the expected size (&quot;&lt;&lt;dims[i+1]&lt;&lt;&quot;)&quot;;
               printer_error().raise(LOCAL_INFO, errmsg.str());
            }
         }

         // Update the variables which control where the next write will occur
         // Index of first element in next target hyperslab (assumes that
         // existing dataset has been written up to a complete chunk)
         dsetnextemptyslab = dims[0];

         return out_dset_id;
      }


      /// Extend dataset to nearest multiple of CHUNKLENGTH above supplied length
      template&lt;class T, std::size_t RR, std::size_t CHUNKLENGTH&gt;
      void DataSetInterfaceBase&lt;T,RR,CHUNKLENGTH&gt;::extend_dset(const unsigned long min_length)
      {
         std::size_t current_length = this-&gt;dsetdims()[0];
         if( min_length &gt; current_length )
         {
            // Extend the dataset to the nearest multiple of CHUNKLENGTH above min_length,
            // unless min_length is itself a multiple of CHUNKLENGTH.
            std::size_t remainder = min_length % CHUNKLENGTH;
            std::size_t newlength;
            if(remainder==0) { newlength = min_length; }
            else             { newlength = min_length - remainder + CHUNKLENGTH; }
            #ifdef HDF5_DEBUG
            std::cout &lt;&lt; &quot;Requested min_length (&quot;&lt;&lt;min_length&lt;&lt;&quot;) larger than current dataset length (&quot;&lt;&lt;current_length&lt;&lt;&quot;) (dset name=&quot;&lt;&lt;this-&gt;get_myname()&lt;&lt;&quot;)&quot; &lt;&lt; std::endl
                      &lt;&lt; &quot;Extending dataset to newlength=&quot;&lt;&lt;newlength&lt;&lt;std::endl;
            #endif
            this-&gt;dsetdims()[0] = newlength;
            //this-&gt;my_dataset.extend( this-&gt;dsetdims() );
            herr_t status = H5Dset_extent( this-&gt;get_dset_id(), this-&gt;dsetdims());
            if(status&lt;0)
            {
               std::cout&lt;&lt;this-&gt;get_dset_id()&lt;&lt;std::endl;
               std::ostringstream errmsg;
               errmsg &lt;&lt; &quot;Failed to extend dataset (with name: \&quot;&quot;&lt;&lt;myname&lt;&lt;&quot;\&quot;) from length &quot;&lt;&lt;current_length&lt;&lt;&quot; to length &quot;&lt;&lt;newlength&lt;&lt;&quot;!&quot;;
               printer_error().raise(LOCAL_INFO, errmsg.str());
            }
         }
      }
      /// @}

  }
}
#endif
</code></pre><hr><p>Updated on 2022-09-08 at 03:08:05 +0000</p></main></div></div></div><footer class="footer text-muted"><div class=container-xxl><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Powered by <a href=https://gohugo.io/>Hugo</a> and <a href=https://getdoks.org/>Doks</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline><li class=list-inline-item><a href=/license/>License</a></li></ul></div></div></div></footer><script src=/js/bootstrap.min.1da7e648bd316d7b1f1bff21fe81545e73f3c2385908a8c3be87f79a560042318b4b13031e53871d84590710da0df312590e0c60b11a6a1b83dede2f81c30b66.js integrity="sha512-HafmSL0xbXsfG/8h/oFUXnPzwjhZCKjDvof3mlYAQjGLSxMDHlOHHYRZBxDaDfMSWQ4MYLEaahuD3t4vgcMLZg==" crossorigin=anonymous defer></script>
<script src=/js/highlight.min.5b48bc253dc75aeea5fb366ecf700f4925e2b6eb1a1466f2124b722d68148d67bc0a9365d2b8ad9c585161b46372d23b08509a16f1fd518542b894756d4752d0.js integrity="sha512-W0i8JT3HWu6l+zZuz3APSSXitusaFGbyEktyLWgUjWe8CpNl0ritnFhRYbRjctI7CFCaFvH9UYVCuJR1bUdS0A==" crossorigin=anonymous defer></script>
<script src=/main.min.162c56a0426544de0d010e66c56e321579655c400c9aae06a6823e7682de379adadf2165bd416fea191e4e7e410fbf1fd2c35a759aa43ff2e3787067669bf81b.js integrity="sha512-FixWoEJlRN4NAQ5mxW4yFXllXEAMmq4GpoI+doLeN5ra3yFlvUFv6hkeTn5BD78f0sNadZqkP/LjeHBnZpv4Gw==" crossorigin=anonymous defer></script>
<script src=https://gambitbsm.github.io/index.min.cccf6ddd4818f08cc1a022b7a6fc3728b38bd559df51a68bcb038fc8187690d4acdd1f30c68365017aad228fed8baffc493ec87cc0093b3db3abdb865b3ae63c.js integrity="sha512-zM9t3UgY8IzBoCK3pvw3KLOL1VnfUaaLywOPyBh2kNSs3R8wxoNlAXqtIo/ti6/8ST7IfMAJOz2zq9uGWzrmPA==" crossorigin=anonymous defer></script></body></html>