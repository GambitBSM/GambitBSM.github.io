<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://gambitbsm.github.io/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://gambitbsm.github.io/fonts/vendor/jost/jost-v4-latin-500.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://gambitbsm.github.io/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><script>(()=>{var e=localStorage.getItem("theme");e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><link rel=stylesheet href=https://gambitbsm.github.io/main.2b4f179ba5137bf560410d5863d012cb95c0a7504da18190247e40a43544a8252fba5dc321f967a611ca9a4d80dec44fabc75d108c7c0e4e8ed381ec007b7391.css integrity="sha512-K08Xm6UTe/VgQQ1YY9ASy5XAp1BNoYGQJH5ApDVEqCUvul3DIflnphHKmk2A3sRPq8ddEIx8Dk6O04HsAHtzkQ==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>file scripts/colouring.py - GAMBIT</title><meta name=description content="[No description available]"><link rel=canonical href=https://gambitbsm.github.io/documentation/code/files/colouring_8py/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="file scripts/colouring.py"><meta property="og:description" content="[No description available]"><meta property="og:url" content="https://gambitbsm.github.io/documentation/code/files/colouring_8py/"><meta property="og:site_name" content="GAMBIT"><meta property="og:image" content="https://gambitbsm.github.io/gambit_logo.png"><meta property="og:image:alt" content="GAMBIT"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content><meta name=twitter:creator content><meta name=twitter:title content="file scripts/colouring.py"><meta name=twitter:description content="[No description available]"><meta name=twitter:image content="https://gambitbsm.github.io/gambit_logo.png"><meta name=twitter:image:alt content="file scripts/colouring.py"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://gambitbsm.github.io/#/schema/organization/1","name":"Doks","url":"https://gambitbsm.github.io/","sameAs":["https://github.com/GambitBSM"],"logo":{"@type":"ImageObject","@id":"https://gambitbsm.github.io/#/schema/image/1","url":"https://gambitbsm.github.io/logo-doks.png","width":450,"height":416,"caption":"Doks"},"image":{"@id":"https://gambitbsm.github.io/#/schema/image/1"}},{"@type":"WebSite","@id":"https://gambitbsm.github.io/#/schema/website/1","url":"https://gambitbsm.github.io/","name":"GAMBIT","description":"Documentation for the Global And Modular BSM Inference Tool","publisher":{"@id":"https://gambitbsm.github.io/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://gambitbsm.github.io/documentation/code/files/colouring_8py/","url":"https://gambitbsm.github.io/documentation/code/files/colouring_8py/","name":"file scripts\/colouring.py","description":"[No description available]","isPartOf":{"@id":"https://gambitbsm.github.io/#/schema/website/1"},"about":{"@id":"https://gambitbsm.github.io/#/schema/organization/1"},"datePublished":"0001-01-01T00:00:00CET","dateModified":"0001-01-01T00:00:00CET","breadcrumb":{"@id":"https://gambitbsm.github.io/documentation/code/files/colouring_8py/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://gambitbsm.github.io/documentation/code/files/colouring_8py/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://gambitbsm.github.io/documentation/code/files/colouring_8py/"]}]},{"@type":"BreadcrumbList","@id":"https://gambitbsm.github.io/documentation/code/files/colouring_8py/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://gambitbsm.github.io/","url":"https://gambitbsm.github.io/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://gambitbsm.github.io/documentation/","url":"https://gambitbsm.github.io/documentation/","name":"Documentation"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://gambitbsm.github.io/documentation/code/","url":"https://gambitbsm.github.io/documentation/code/","name":"Code"}},{"@type":"ListItem","position":4,"item":{"@type":"WebPage","@id":"https://gambitbsm.github.io/documentation/code/files/","url":"https://gambitbsm.github.io/documentation/code/files/","name":"Files"}},{"@type":"ListItem","position":5,"item":{"@id":"https://gambitbsm.github.io/documentation/code/files/colouring_8py/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://gambitbsm.github.io/documentation/code/files/colouring_8py/#/schema/image/2","url":"https://gambitbsm.github.io/gambit_logo.png","contentUrl":"https://gambitbsm.github.io/gambit_logo.png","caption":"file scripts\/colouring.py"}]}]}</script><meta name=theme-color content="#fff"><link rel=icon href=https://gambitbsm.github.io/favicon.ico sizes=any><link rel=icon type=image/svg+xml href=https://gambitbsm.github.io/favicon.svg><link rel=apple-touch-icon sizes=180x180 href=https://gambitbsm.github.io/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://gambitbsm.github.io/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://gambitbsm.github.io/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=https://gambitbsm.github.io/site.webmanifest></head><body class="documentation single light"><div class=sticky-top><div class=header-bar></div><header class="navbar navbar-expand-md navbar-light doks-navbar"><nav class="container-xxl flex-wrap flex-md-nowrap" aria-label="Main navigation"><a class="navbar-brand p-0 me-auto" href=https://gambitbsm.github.io/ aria-label=GAMBIT><img class=logo-light src=https://gambitbsm.github.io//images/gambit_logo.png width=50px>
<img class="logo-dark d-none" src=https://gambitbsm.github.io//images/gambit_logo.png width=50px>
GAMBIT</a>
<button class="btn btn-menu order-2 d-block d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasDoks aria-controls=offcanvasDoks aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-end border-0 py-lg-1" tabindex=-1 id=offcanvasDoks data-bs-backdrop=true aria-labelledby=offcanvasDoksLabel><div class="header-bar d-lg-none"></div><div class="offcanvas-header d-lg-none"><h2 class="h5 offcanvas-title ps-2" id=offcanvasDoksLabel><a class=text-dark href=/>GAMBIT</a></h2><button type=button class="btn-close text-reset me-2" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class="offcanvas-body p-4 p-lg-0"><ul class="nav flex-column flex-lg-row align-items-lg-center mt-2 mt-lg-0 ms-lg-2 me-lg-auto"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle ps-0 py-1" href=# id=navbarDropdownMenuLink role=button data-bs-toggle=dropdown aria-expanded=false>Releases
<span class=dropdown-caret><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></a><ul class="dropdown-menu dropdown-menu-main shadow rounded border-0" aria-labelledby=navbarDropdownMenuLink><li><a class=dropdown-item href=https://github.com/GambitBSM/gambit_2.2>GAMBIT 2-2 ⧉</a></li><li><a class=dropdown-item href=https://github.com/GambitBSM/gambit_2.1>GAMBIT 2-1 ⧉</a></li><li><a class=dropdown-item href=https://github.com/GambitBSM/gambit_2.2/tags>All releases ⧉</a></li></ul></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle ps-0 py-1" href=# id=navbarDropdownMenuLink role=button data-bs-toggle=dropdown aria-expanded=false>Documentation
<span class=dropdown-caret><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></a><ul class="dropdown-menu dropdown-menu-main shadow rounded border-0" aria-labelledby=navbarDropdownMenuLink><li><a class=dropdown-item href=/documentation/installation/introduction/>Installation</a></li><li><a class=dropdown-item href=/documentation/examples/colliderbit_example>Examples</a></li><li><a class=dropdown-item href=/documentation/help/common_problems_and_questions/>Help</a></li><li><a class=dropdown-item href=/documentation/code/index_classes>Code Reference</a></li></ul></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle ps-0 py-1" href=# id=navbarDropdownMenuLink role=button data-bs-toggle=dropdown aria-expanded=false>Community
<span class=dropdown-caret><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></a><ul class="dropdown-menu dropdown-menu-main shadow rounded border-0" aria-labelledby=navbarDropdownMenuLink><li><a class=dropdown-item href=/community/publications/>Publications</a></li><li><a class=dropdown-item href=/community/talks/>Talks</a></li><li><a class=dropdown-item href=/community/members/>Members</a></li><li><a class=dropdown-item href=/community/code_of_conduct/>Code of Conduct</a></li><li><a class=dropdown-item href=/community/contact/>Contact</a></li></ul></li></ul><hr class="text-black-50 my-4 d-lg-none"><form class="doks-search position-relative flex-grow-1 ms-lg-auto me-lg-2"><input id=search class="form-control is-search" type=search placeholder="Search site..." aria-label="Search site..." autocomplete=off><div id=suggestions class="shadow bg-white rounded d-none"></div></form><hr class="text-black-50 my-4 d-lg-none"><ul class="nav flex-column flex-lg-row"><li class=nav-item><a class="nav-link social-link" href=https://github.com/GambitBSM><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><small class="ms-2 d-lg-none">GitHub</small></a></li></ul><hr class="text-black-50 my-4 d-lg-none"><button id=mode class="btn btn-link" type=button aria-label="Toggle user interface mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></div></div></nav></header></div><div class="wrap container-xxl" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar"><nav class=docs-links aria-label="Main navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-installation aria-expanded=false>
Installation</button><div class=collapse id=section-installation><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/documentation/installation/introduction/>Getting Started</a></li><li><a class="docs-link rounded" href=/documentation/installation/docker_usage/>Docker Usage</a></li><li><a class="docs-link rounded" href=/documentation/installation/installation_for_linux/>Installation for Linux</a></li><li><a class="docs-link rounded" href=/documentation/installation/installation_for_windows/>Installation for Windows</a></li><li><a class="docs-link rounded" href=/documentation/installation/installation_for_macos/>Installation for macOS</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-examples aria-expanded=false>
Examples</button><div class=collapse id=section-examples><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/documentation/examples/colliderbit_example/>ColliderBit Example</a></li><li><a class="docs-link rounded" href=/documentation/examples/anotherbit/>AnotherBit</a></li><li><a class="docs-link rounded" href=/documentation/examples/anotherbit2/>AnotherBit2</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-help aria-expanded=false>
Help</button><div class=collapse id=section-help><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/documentation/help/common_problems_and_questions/>Common Problems and Questions</a></li><li><a class="docs-link rounded" href=/documentation/help/compiler_matrix/>Compiler Matrix</a></li><li><a class="docs-link rounded" href=/documentation/help/known_issues/>Known Issues</a></li><li><a class="docs-link rounded" href=/documentation/help/configuration_examples/>Configuration Examples</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-code aria-expanded=false>
Code Reference</button><div class=collapse id=section-code><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/documentation/code/index_classes/>Classes</a></li><li><a class="docs-link rounded" href=/documentation/code/index_files/>Files</a></li><li><a class="docs-link rounded" href=/documentation/code/index_pages/>Pages</a></li><li><a class="docs-link rounded" href=/documentation/code/index_namespaces/>Namespaces</a></li></ul></div></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=d-xl-none><button class="btn btn-outline-primary btn-sm doks-toc-toggle collapsed" type=button data-bs-toggle=collapse data-bs-target=#onThisPage aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle On this page navigation">
<span>On this page</span>
<span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></span></button><div class=collapse id=onThisPage><div class="card card-body mt-3 py-1"><div class=page-links><nav id=TableOfContents><ul><li><a href=#namespaces>Namespaces</a></li><li><a href=#source-code>Source code</a></li></ul></nav></div></div></div></div><div class="page-links d-none d-xl-block"><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#namespaces>Namespaces</a></li><li><a href=#source-code>Source code</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9 mx-xl-auto"><nav aria-label=breadcrumb><ol class=breadcrumb><li class=breadcrumb-item><a href=/>Home</a></li><li class=breadcrumb-item><a href=/documentation/>Documentation</a></li><li class=breadcrumb-item><a href=/documentation/code/>Code Reference</a></li><li class="breadcrumb-item active" aria-current=page>file scripts/colouring.py</li></ol></nav><p class=lead></p><h1 id=file-scripts-colouring-py>file scripts/colouring.py</h1><p>[No description available]</p><h2 id=namespaces>Namespaces <a href=#namespaces class=anchor aria-hidden=true>#</a></h2><table><thead><tr><th>Name</th></tr></thead><tbody><tr><td><strong><a href=/documentation/code/namespaces/namespacecolouring/>colouring</a></strong></td></tr></tbody></table><h2 id=source-code>Source code <a href=#source-code class=anchor aria-hidden=true>#</a></h2><pre><code>#!/usr/bin/env python
#
# GAMBIT: Global and Modular BSM Inference Tool
#*********************************************
# \file
#
#  The GAMBIT Colouring-in Book
#
#  A script for priming pippi runs and patching
#  together their outputs. Designed to allow
#  one to highlight specific regions of preferred
#  parameter space, and then overplot them
#  (e.g. relic density mechanisms).
#
#*********************************************
#
#  Authors (add name and date if you modify):
#
#  \author Pat Scott
#          (p.scott@imperial.ac.uk)
#    \date 2017 Feb
#
#*********************************************

import sys
import yaml
import os
import copy
import re
import datetime
import stat
from multiprocessing import cpu_count

# Global constants
verbose = False
default_contour = 95.4
default_contour_style = &quot;Solid&quot;
default_contour_width = 2
default_colour = &quot;blue&quot;
default_n_contours = 150
n_threads = cpu_count()

# Checks for the presence of one or more keys in a YAML node
def check_node(node, name, keys):
  is_ok = False
  if isinstance(keys, basestring):
    error = &quot;  Region \&quot;&quot;+name+&quot;\&quot; must have key \&quot;&quot;+str(keys)+&quot;\&quot;.&quot;
    is_ok = (keys in node)
  else:
    error = &quot;  Region \&quot;&quot;+name+&quot;\&quot; must have at least one of the keys &quot;+str(keys)+&quot;.&quot;
    for x in keys:
      if (x in node):
        is_ok = True
        break
  if not is_ok: sys.exit(error)


def usage():
  sys.exit('\n  Usage: colouring [prime/combine] file1 file2\n  where file1 is a YAML file that defines the regions you want to find.\n        file2 is the pip file that defines the pippi run to modify.\n')


def main(arguments):
  #Starting routine

  commandLineOptions = { 'prime':prime, 'combine':combine }

  if (len(arguments) is not 4):
    #Print usage info and quit if pippi is invoked without an argument
    usage()

  else:

    try:
      #Check if colouring has been invoked with one of the two known specific commands
      command = commandLineOptions[arguments[1]]
      command(arguments[2], arguments[3])
    except KeyError:
      print
      print 'Unrecognised colouring mode: '+arguments[1]
      usage()

  sys.exit()


# Prepare separate pippi runs for each region
def prime(region_file, pip_file):

  print

  # Load up the regions from the yaml file, and the template for pippi runs from the pip file.
  yaml_loader = yaml.full_load if hasattr(yaml, 'full_load') else yaml.load
  regions = yaml_loader(file(region_file, 'r'))
  pip = file(pip_file, 'r').read()

  # Get the drawing order
  if regions[&quot;drawing_order&quot;]:
    drawing_order = regions[&quot;drawing_order&quot;]
  else:
    sys.exit('ERROR: No drawing_order specified in '+region_file)

  # Retrieve the best fit in the base scan.
  #First work out where the best fit file is.  Start with the dir.
  parse_dir = re.search('parse_dir\s*=\s*(&quot;(.*)&quot;|\'(.*)\')', pip)
  parse_dir = parse_dir.group(2 if parse_dir.group(2) else 3)
  # Now infer the filename from the chain name.
  chain_name = re.search('main_chain\s*=\s*(&quot;(.*)&quot;|\'(.*)\')', pip)
  chain_name = chain_name.group(2 if chain_name.group(2) else 3)
  chain_name = re.sub(r'.*/|\..?.?.?$', '', chain_name)
  best_filename = parse_dir+&quot;/&quot;+chain_name+&quot;.best&quot;
  # Now open the file and read in the best fit.
  best_file = file(best_filename, 'r')
  for x in best_file.readlines():
    if not x.startswith('#'):
      parts = x.split(':')
      bestFit = float(parts[1])
      break


  # Iterate over the regions defined in the yaml file
  for name in drawing_order:
    if (verbose): print &quot;Priming pippi run for extracting region: &quot;+name
    mechanism = regions[name]

    # Check that the mechanism is sufficiently specified
    check_node(mechanism, name, [&quot;extra_1D_plots&quot;, &quot;extra_2D_plots&quot;])
    check_node(mechanism, name, &quot;datastream&quot;)
    check_node(mechanism, name, &quot;cut&quot;)
    check_node(mechanism, name, &quot;label&quot;)

    # Make a new pip file for this region
    newpip = copy.deepcopy(pip)

    # Replace the necessary parts of it, starting with the common section
    contour = default_contour
    if (&quot;contour_levels&quot; in mechanism): contour = mechanism[&quot;contour_levels&quot;]
    newpip = re.sub('contour_levels\s*=.*\n', 'contour_levels = '+str(contour)+'\n', newpip)
    if (&quot;extra_1D_plots&quot; in mechanism): newpip = re.sub('oneD_plot_quantities\s*=\s*', 'oneD_plot_quantities = '+str(mechanism[&quot;extra_1D_plots&quot;])+' ', newpip)
    if (&quot;extra_2D_plots&quot; in mechanism): newpip = re.sub('twoD_plot_quantities\s*=\s*', 'twoD_plot_quantities = '+str(mechanism[&quot;extra_2D_plots&quot;])+' ', newpip)
    newpip = re.sub(&quot;bf_lnlike_for_profile_like\s*=\s*&quot;, &quot;bf_lnlike_for_profile_like = &quot;+str(bestFit)+&quot; &quot;, newpip)

    # Now the parse section
    newpip = re.sub('parse_dir\s*=.*\n', 'parse_dir = \'parse_'+name+'\'\n', newpip)
    newpip = re.sub('data_ranges\s*=\s*', 'data_ranges = '+mechanism[&quot;cut&quot;]+' ', newpip)
    if (&quot;preamble&quot; in mechanism): newpip = re.sub('preamble\s*=.*\n', 'preamble = \''+mechanism[&quot;preamble&quot;]+'\'\n', newpip)
    newpip = re.sub('assign_to_pippi_datastream\s*=\s*', 'assign_to_pippi_datastream =   '
     +mechanism[&quot;datastream&quot;]+' \\\n                               ', newpip)
    newpip = re.sub('quantity_labels\s*=\s*', 'quantity_labels =   '
     +mechanism[&quot;label&quot;]+' \\\n                    ', newpip)

    # Now the script section
    newpip = re.sub('script_dir\s*=.*\n', 'script_dir = \'scripts_'+name+'\'\n', newpip)
    colour = default_colour
    if (&quot;colour&quot; in mechanism): colour = mechanism[&quot;colour&quot;]
    newpip = re.sub('colour_scheme\s*=.*\n', 'colour_scheme = Blockshading_'+colour+'\n', newpip)

    # Now the plot section
    newpip = re.sub('plot_dir\s*=.*\n', 'plot_dir = \'plots_'+name+'\'\n', newpip)

    # Output the new pip file
    filename = os.path.splitext(pip_file)
    filename = filename[0]+&quot;_&quot;+name+filename[1]
    with open(filename,&quot;w&quot;) as f:
      f.write(newpip)
      print &quot;  Generated new pip file &quot;+filename

  print


def combine(region_file, pip_file):

  # Load up the regions from the yaml file, and the template for pippi runs from the pip file.
  regions = yaml.load(file(region_file, 'r'))
  pip = file(pip_file, 'r').read()

  # Get the drawing order
  if regions[&quot;drawing_order&quot;]:
    drawing_order = regions[&quot;drawing_order&quot;]
  else:
    sys.exit('ERROR: No drawing_order specified in '+region_file)

  # Find the filenames of all the 2D profile likelihood scripts
  script_dir = re.search('script_dir\s*=\s*(&quot;(.*)&quot;|\'(.*)\')', pip)
  script_dir = script_dir.group(2 if script_dir.group(2) else 3)
  like2D_scripts = [x for x in os.listdir(script_dir) if &quot;like2D&quot; in x]

  # Make a new scripts dir for the combined scripts
  combo_dir = script_dir+'_combined'
  if not os.path.isdir(combo_dir): os.mkdir(combo_dir)

  # Make a new plots dir for the combined plots
  plot_dir = re.search('plot_dir\s*=\s*(&quot;(.*)&quot;|\'(.*)\')', pip)
  plot_dir = plot_dir.group(2 if plot_dir.group(2) else 3)
  plot_combo_dir = plot_dir+'_combined'
  if not os.path.isdir(plot_combo_dir): os.mkdir(plot_combo_dir)

  # Make a bulk script that calls all of the combined plotting scripts
  bulkscript_name = 'make_combined_'+re.sub('\.pip', '', pip_file)+'_plots.bsh'
  bulkscript = file(bulkscript_name, 'w')
  bulkscript.write('cd '+combo_dir+'\n')

  # Iterate over the different scripts
  for script_index, script_name in enumerate(like2D_scripts):

    # Initialise empty lists of the things that will vary with region
    marker_commands = []
    plot_commands = []
    fill_colours = []
    contour_commands = []
    min_contours = []
    region_names = []
    regional_script = None

    # Iterate over all the regions mentioned in the drawing order
    for name in drawing_order:

      # Open the script file, cycling if it doesn't exist
      fullname = script_dir+'_'+name+'/'+script_name
      if not os.path.isfile(fullname): continue
      regional_script = file(fullname, 'r').read()

      # Save the name of the region
      region_names.append(name)

      # Save the line style for the region
      contour_style = regions[name][&quot;contour_style&quot;] if &quot;contour_style&quot; in regions[name] else default_contour_style

      # Extract the marker command
      marker_command = re.findall('\s\s--draw-marker.*\n', regional_script)
      if marker_command: marker_commands.append(marker_command[0])

      # Extract the fill colour
      fill_colour = re.findall('--#...', regional_script)
      fill_colours.append(fill_colour[1][2:])

      # Extract the plot command
      plot_command = re.findall('\s\s--plot.*fill-transparency 1.*\n', regional_script)
      plot_commands.append(plot_command[0])

      # Extract the contour command
      contour_command_list = re.findall('\s\s--draw-contour.*\n', regional_script)
      min_contour = 1.0
      for i,x in enumerate(contour_command_list):
        contour_command_list[i] = re.sub('width.*\n', 'width '+str(default_contour_width)+'\\\n', x)
        contour_command_list[i] = re.sub('style\s*.*?\s', 'style '+contour_style+' ', contour_command_list[i])
        min_contour = min(min_contour, float(re.search('--draw-contour\s(.*?)\s', contour_command_list[i]).group(1)))
      contour_commands.append(contour_command_list)
      min_contours.append(min_contour)

    # If this script is not present for any of the regions, go on to the next one.
    if (regional_script is None): continue

    # Extract the axis styles from the last regional script
    axis_styles = re.findall('\s\s--axis-style\s*[^y]*\n', regional_script)

    # Read in the original script
    base_script = file(script_dir+'/'+script_name, 'r').readlines()

    # Extract preamble from original script
    preamble = ''
    for x in base_script[2:]:
     preamble = preamble+x
     if x.startswith('  --xyz-map'): break

    # Extract textual annotations from the original script
    text = [re.sub('White','Black',x) for x in base_script if x.startswith('  --draw-text') or x.startswith('  --legend')]

    outfile = open(combo_dir+'/'+script_name,'w')
    outfile.write('#!/usr/bin/env bash\n')
    outfile.write('# This plot script created by the pippi scripter \'colouring\' on '+datetime.datetime.now().strftime('%c')+'\n')

    # Write the number of fill steps to be used
    for region in region_names: outfile.write('n_contours_'+re.sub('-','_',region)+'='+str(default_n_contours)+'\n')

    # Write the fist half of the ctioga2 command
    outfile.write(preamble)

    # Draw the filled regions, using many closely-packed contours
    for region, plot_command in enumerate(plot_commands):
      outfile.write('  --color \''+fill_colours[region]+'\' \\\n')
      outfile.write(plot_command)
      outfile.write('    $(echo $(for (( i=0; i&lt;$n_contours_'+re.sub('-','_',region_names[region])+'; i++ )); do echo &quot;--draw-contour '
                    '$(echo &quot;'+str(min_contours[region])+' + '+str(1.0-min_contours[region])+'*$i/($n_contours_'
                    +re.sub('-','_',region_names[region])+'-1)&quot; | bc -l) /style Solid /width '+str(default_contour_width)+' &quot;; done)) \\\n')
      outfile.write('  --draw-contour 1.000 /style Solid /width '+str(default_contour_width)+'\\\n')

    # Draw the actual outline contours on top of all the filled regions
    for region, plot_command in enumerate(plot_commands):
      outfile.write(plot_command)
      for x in contour_commands[region]: outfile.write(x)

    # Draw any markers
    for marker_command in marker_commands:
      outfile.write(marker_command)

    # Write any textual annotations, and set the axes up in the manner of the region plots
    for x in text: outfile.write(x)
    for x in axis_styles: outfile.write(x)

    # Add an entry to the bulk plotting script
    pdf_name = re.sub(&quot;\.bsh&quot;, &quot;.pdf&quot;, script_name)
    bulkscript.write('(echo &quot;./'+script_name+'&quot; &amp;&amp; ./' + script_name +
    ' &amp;&amp; gs -sDEVICE=pdfwrite -dCompatibilityLevel=1.4 -dPDFSETTINGS=/screen -dNOPAUSE -dQUIET -dBATCH -sOutputFile='+
    '../' + plot_combo_dir + '/' + pdf_name + ' ' + pdf_name +
    ' &amp;&amp; rm ' + pdf_name + ') &amp;\n')
    if (script_index%n_threads == n_threads - 1 ): bulkscript.write('wait\n')

    # Done!  Close the new script file and make it executable for both user and group.
    outfile.close
    os.chmod(combo_dir+'/'+script_name, stat.S_IRWXU | stat.S_IRWXG)

  # All over red rover.  Go write a paper.
  bulkscript.write('wait\n')
  bulkscript.write('echo &quot;Generated all combined plots.  Now go write a paper!&quot;\n')
  bulkscript.close
  os.chmod(bulkscript_name, stat.S_IRWXU | stat.S_IRWXG)

#Actual program launched on invocation
main(sys.argv)
</code></pre><hr><p>Updated on 2022-09-08 at 01:05:19 +0000</p></main></div></div></div><footer class="footer text-muted"><div class=container-xxl><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Powered by <a href=https://gohugo.io/>Hugo</a> and <a href=https://getdoks.org/>Doks</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline><li class=list-inline-item><a href=/license/>License</a></li></ul></div></div></div></footer><script src=/js/bootstrap.min.1da7e648bd316d7b1f1bff21fe81545e73f3c2385908a8c3be87f79a560042318b4b13031e53871d84590710da0df312590e0c60b11a6a1b83dede2f81c30b66.js integrity="sha512-HafmSL0xbXsfG/8h/oFUXnPzwjhZCKjDvof3mlYAQjGLSxMDHlOHHYRZBxDaDfMSWQ4MYLEaahuD3t4vgcMLZg==" crossorigin=anonymous defer></script>
<script src=/js/highlight.min.5b48bc253dc75aeea5fb366ecf700f4925e2b6eb1a1466f2124b722d68148d67bc0a9365d2b8ad9c585161b46372d23b08509a16f1fd518542b894756d4752d0.js integrity="sha512-W0i8JT3HWu6l+zZuz3APSSXitusaFGbyEktyLWgUjWe8CpNl0ritnFhRYbRjctI7CFCaFvH9UYVCuJR1bUdS0A==" crossorigin=anonymous defer></script>
<script src=/main.min.162c56a0426544de0d010e66c56e321579655c400c9aae06a6823e7682de379adadf2165bd416fea191e4e7e410fbf1fd2c35a759aa43ff2e3787067669bf81b.js integrity="sha512-FixWoEJlRN4NAQ5mxW4yFXllXEAMmq4GpoI+doLeN5ra3yFlvUFv6hkeTn5BD78f0sNadZqkP/LjeHBnZpv4Gw==" crossorigin=anonymous defer></script>
<script src=https://gambitbsm.github.io/index.min.fbb6553b7dc60d665ec93413610230d0115e1a7b4973fac0051de5316971543760c7c910a8ad22be671156484cfdc9aa9017fd6dd9c1bc716d967cad3f86572e.js integrity="sha512-+7ZVO33GDWZeyTQTYQIw0BFeGntJc/rABR3lMWlxVDdgx8kQqK0ivmcRVkhM/cmqkBf9bdnBvHFtlnytP4ZXLg==" crossorigin=anonymous defer></script></body></html>